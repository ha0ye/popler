popler\_data\_organizatonal\_hierarchy
================
Hao Ye, Ellen Bledsoe
5/21/2019

``` r
library(tidyverse)

all_data <- readRDS("list_df.rds")
df <- as_tibble(all_data[[params$dataset_index]])

cat("My project metadata key is ", 
    df$proj_metadata_key[1], "!!")
```

    ## My project metadata key is  827 !!

``` r
# figure out the spatial replication levels
df %>% 
  select(starts_with("spatial_replication_level")) %>%
  NCOL() %>%
  {./2} -> num_sr_levels
```

``` r
# transform the names of the variables
#   - get rid of the `spatial_replication_level_#_label` columns
sr_vars <- character(num_sr_levels)
for (i in seq(num_sr_levels))
{
  new_name <- paste0(i, "--", df[1, paste0("spatial_replication_level_", i, "_label")])
  old_name <- paste0("spatial_replication_level_", i)
  sr_vars[i] <- new_name
  df <- rename(df, !!new_name := !!old_name)
}
```

``` r
# extract just the spatial replication level data
data_organization <- df %>%
  select(sr_vars)
```

``` r
# generate contingency tables to summarize organizational structure:
#   - level_i vs. level_j (i < j)

cols <- expand.grid(i = seq(num_sr_levels), 
                    j = seq(num_sr_levels)) %>%
  filter(i < j)

sr_tables <- purrr::pmap(cols, function(i, j) {
    data_organization %>%
      select(sr_vars[c(i, j)]) %>%
      table()
  })
```

``` r
# loop over tables and output
purrr::map(sr_tables, knitr::kable)
```

    ## [[1]]
    ## 
    ## 
    ##                             1     10     11     12     13    14   15   16     17   18   19      2   20     21   22    24   25     27   28   29     3    30     31   32    33    34     35    36     37     38     39      4     40     41   42    43    44     45    46     47     5     6      7      8      9
    ## ----------------------  -----  -----  -----  -----  -----  ----  ---  ---  -----  ---  ---  -----  ---  -----  ---  ----  ---  -----  ---  ---  ----  ----  -----  ---  ----  ----  -----  ----  -----  -----  -----  -----  -----  -----  ---  ----  ----  -----  ----  -----  ----  ----  -----  -----  -----
    ## site_ntl_fish_lake         82    115   1169    104      0     0    0    0      0    0    0   1014    0      0    0     0    0      0    0    0    62     0      0    0     0     0      0     0      0      0      0     96      0      0    0     0     0      0     0      0   816    72   1009     72   1121
    ## site_ntl_mendota_lake      98      0     39      0      0   348   26   58   1103   68   57     62   74   1363   67   103   67   1322   54   67    57   124   1288   86   147   130   1350   126   1585   1405   1270    736   1411   1429   50   158   162   1600   110   1189    53     0     78     64   1441
    ## site_ntl_monona_lake     1278   1411    186      0   1405     0    0    0      0    0    0   1168    0      0    0     0    0      0    0    0   114     0      0    0     0     0      0     0      0      0      0   1482      0      0    0     0     0      0     0      0    98     0      0   1052     28
    ## site_ntl_wingra_lake       96   1252    187   1429      0     0    0    0      0    0    0   1070    0      0    0     0    0      0    0    0   148     0      0    0     0     0      0     0      0      0      0   1344      0      0    0     0     0      0     0      0   171   273   1282    182     71
    ## 
    ## [[2]]
    ## 
    ## 
    ##                           1.0    1.5    2.0    2.5    3.0    3.5    4.0   4.5
    ## ----------------------  -----  -----  -----  -----  -----  -----  -----  ----
    ## site_ntl_fish_lake       2131   1414   1021    670    370    115     11     0
    ## site_ntl_mendota_lake    3541   3994   3959   3500   2880   1985   1124    42
    ## site_ntl_monona_lake     1934   1835   1576   1270    896    480    218    13
    ## site_ntl_wingra_lake     1424   1410   1340   1130    890    726    520    65
    ## 
    ## [[3]]
    ## 
    ## 
    ##       1.0   1.5   2.0   2.5   3.0   3.5   4.0   4.5
    ## ---  ----  ----  ----  ----  ----  ----  ----  ----
    ## 1     386   367   310   219   165    85    22     0
    ## 10    644   578   517   402   291   207   131     8
    ## 11    470   345   291   258   121    54    24    18
    ## 12    302   323   304   241   171   105    83     4
    ## 13    294   311   267   209   147   120    57     0
    ## 14     20    16    66   127   100    16     3     0
    ## 15     10     6    10     0     0     0     0     0
    ## 16      7     7    16    17     9     2     0     0
    ## 17    190   203   240   186   145    82    57     0
    ## 18      9    14    13    17    15     0     0     0
    ## 19     20    14     8    12     3     0     0     0
    ## 2     895   752   613   421   310   211   109     3
    ## 20     16    20    14     2    13     5     2     2
    ## 21    238   261   223   221   192   141    87     0
    ## 22     18    15     5     1    18    10     0     0
    ## 24     17    17    27    34     8     0     0     0
    ## 25     15     8     6    21    17     0     0     0
    ## 27    171   220   236   264   221   150    60     0
    ## 28     17     9    17    11     0     0     0     0
    ## 29     19    19    10    12     4     3     0     0
    ## 3     111    81    59    53    37    31     9     0
    ## 30     29    23    19    18    15    13     7     0
    ## 31    174   223   234   227   185   149    96     0
    ## 32      1     4    10    10    23    14    20     4
    ## 33     26    30    21    25    19    10    10     6
    ## 34      0    28    27    10    21    22    22     0
    ## 35    210   284   282   217   163   119    75     0
    ## 36     22    28    19    20    17    13     7     0
    ## 37    263   299   300   263   209   153    95     3
    ## 38    311   333   281   202   167    75    35     1
    ## 39    260   238   255   217   151    90    56     3
    ## 4     834   781   667   545   421   252   157     1
    ## 40    282   262   246   208   180   150    82     1
    ## 41    298   282   254   223   180   125    67     0
    ## 42     11     8    11    17     3     0     0     0
    ## 43     16    23    19    28    25    28    12     7
    ## 44      4    23    25    35    32    25    15     3
    ## 45    150   265   292   290   254   201   139     9
    ## 46     28    27    11    20    10     7     5     2
    ## 47    186   235   241   155   156   145    71     0
    ## 5     373   264   189   124   109    62    14     3
    ## 6      84    60    46    43    33    33    26    20
    ## 7     627   499   430   337   233   131   111     1
    ## 8     334   327   257   198   140    70    25    19
    ## 9     638   521   508   410   303   197    82     2
    ## 
    ## [[4]]
    ## 
    ## 
    ##                             1      2      3      4
    ## ----------------------  -----  -----  -----  -----
    ## site_ntl_fish_lake       1457   1453   1415   1407
    ## site_ntl_mendota_lake    5264   5284   5250   5227
    ## site_ntl_monona_lake     2050   2014   2088   2070
    ## site_ntl_wingra_lake     1866   1869   1900   1870
    ## 
    ## [[5]]
    ## 
    ## 
    ##         1     2     3     4
    ## ---  ----  ----  ----  ----
    ## 1     395   383   393   383
    ## 10    682   697   710   689
    ## 11    414   393   386   388
    ## 12    372   377   379   405
    ## 13    356   335   363   351
    ## 14     84    94    95    75
    ## 15     10     8     4     4
    ## 16     18    12    12    16
    ## 17    250   300   269   284
    ## 18     14    21    17    16
    ## 19     11    13    17    16
    ## 2     830   840   841   803
    ## 20     23    18    12    21
    ## 21    343   348   338   334
    ## 22     16    14    17    20
    ## 24     19    30    24    30
    ## 25     22    17    15    13
    ## 27    333   315   340   334
    ## 28     11    11    15    17
    ## 29     22    17    13    15
    ## 3      97   100    92    92
    ## 30     29    31    30    34
    ## 31    317   316   336   319
    ## 32     19    24    18    25
    ## 33     43    33    29    42
    ## 34     33    34    32    31
    ## 35    332   343   338   337
    ## 36     32    29    32    33
    ## 37    399   411   399   376
    ## 38    356   345   343   361
    ## 39    332   309   302   327
    ## 4     922   907   918   911
    ## 40    369   345   349   348
    ## 41    342   362   361   364
    ## 42     13    14    11    12
    ## 43     43    33    44    38
    ## 44     33    40    47    42
    ## 45    404   405   401   390
    ## 46     24    33    27    26
    ## 47    292   294   300   303
    ## 5     283   288   282   285
    ## 6      88    85    85    87
    ## 7     598   585   597   589
    ## 8     346   338   345   341
    ## 9     666   673   675   647
    ## 
    ## [[6]]
    ## 
    ## 
    ##           1      2      3      4
    ## ----  -----  -----  -----  -----
    ## 1.0    2277   2243   2232   2278
    ## 1.5    2110   2196   2142   2205
    ## 2.0    1981   1969   2006   1940
    ## 2.5    1662   1653   1664   1591
    ## 3.0    1284   1247   1274   1231
    ## 3.5     826    828    822    830
    ## 4.0     466    461    481    465
    ## 4.5      31     23     32     34
