popler\_data\_organizatonal\_hierarchy
================
Hao Ye, Ellen Bledsoe
5/21/2019

``` r
library(tidyverse)

all_data <- readRDS("list_df.rds")
df <- as_tibble(all_data[[params$dataset_index]])

cat("My project metadata key is ", 
    df$proj_metadata_key[1], "!!")
```

    ## My project metadata key is  788 !!

``` r
# figure out the spatial replication levels
df %>% 
  select(starts_with("spatial_replication_level")) %>%
  NCOL() %>%
  {./2} -> num_sr_levels
```

``` r
# transform the names of the variables
#   - get rid of the `spatial_replication_level_#_label` columns
sr_vars <- character(num_sr_levels)
for (i in seq(num_sr_levels))
{
  new_name <- paste0(i, "--", df[1, paste0("spatial_replication_level_", i, "_label")])
  old_name <- paste0("spatial_replication_level_", i)
  sr_vars[i] <- new_name
  df <- rename(df, !!new_name := !!old_name)
}
```

``` r
# extract just the spatial replication level data
data_organization <- df %>%
  select(sr_vars)
```

``` r
# generate contingency tables to summarize organizational structure:
#   - level_i vs. level_j (i < j)

cols <- expand.grid(i = seq(num_sr_levels), 
                    j = seq(num_sr_levels)) %>%
  filter(i < j)

sr_tables <- purrr::pmap(cols, function(i, j) {
    data_organization %>%
      select(sr_vars[c(i, j)]) %>%
      table()
  })
```

``` r
# loop over tables and output
purrr::map(sr_tables, knitr::kable)
```

    ## [[1]]
    ## 
    ## 
    ##                  1001   1002   1003   1004   1005   1006   1007   1008   1009   101   1010   1011   1012   1013   1014   1015   1016   1017   1018   1019   102   1020   1021   1022   1023   1024   1025    103   104   105   106   107   108    109    110   1101   1102   1103   1104   1105   1106   1107   1108   1109   111   1110   1111   1112   1113   1114   1115   1116   1117   1118   1119   112   1120   1121   1122   1123   1124   1125   113    114    115    116    117    118   119    120   1201   1202   1203   1204   1205   1206   1207   1208   1209   121   1210   1211   1212   1213   1214   1215   1216   1217   1218   1219   122   1220   1221   1222   1223   1224   1225   123    124    125   1301   1302   1303   1304   1305   1306   1307   1308   1309   1310   1311   1312   1313   1314   1315   1316   1317   1318   1319   1320   1321   1322   1323   1324   1325   1401   1402   1403   1404   1405   1406   1407   1408   1409   1410   1411   1412   1413   1414   1415   1416   1417   1418   1419   1420   1421   1422   1423   1424   1425   1501   1502   1503   1504   1505   1506   1507   1508   1509   1510   1511   1512   1513   1514   1515   1516   1517   1518   1519   1520   1521   1522   1523   1524   1525   1601   1602   1603   1604   1605   1606   1607   1608   1609   1610   1611   1612   1613   1614   1615   1616   1617   1618   1619   1620   1621   1622   1623   1624   1625   201   202   203   204   205   206   207   208   209   210   211   212   213   214    215    216    217    218    219    220   221   222   223    224    225   301   302   303   304   305   306   307   308    309   310   311   312   313   314   315    316    317    318    319    320    321   322    323    324    325    401    402   403   404   405   406   407   408   409   410   411   412   413   414   415    416    417    418    419    420    421    422    423    424    425    501   502   503   504   505   506   507   508    509   510   511   512   513   514    515    516    517    518    519    520    521    522    523    524    525   601   602   603   604   605   606   607   608    609    610   611   612   613   614   615    616    617    618    619    620    621    622    623    624    625   701   702   703   704   705   706   707   708   709    710    711   712   713   714   715   716    717    718    719    720    721    722    723    724    725    801   802   803   804   805   806   807    808   809   810   811   812    813    814    815   816    817    818    819    820    821    822    823    824    825   901    902   903   904   905   906    907    908   909   910    911   912    913   914    915    916    917    918    919    920    921    922    923    924    925
    ## --------------  -----  -----  -----  -----  -----  -----  -----  -----  -----  ----  -----  -----  -----  -----  -----  -----  -----  -----  -----  -----  ----  -----  -----  -----  -----  -----  -----  -----  ----  ----  ----  ----  ----  -----  -----  -----  -----  -----  -----  -----  -----  -----  -----  -----  ----  -----  -----  -----  -----  -----  -----  -----  -----  -----  -----  ----  -----  -----  -----  -----  -----  -----  ----  -----  -----  -----  -----  -----  ----  -----  -----  -----  -----  -----  -----  -----  -----  -----  -----  ----  -----  -----  -----  -----  -----  -----  -----  -----  -----  -----  ----  -----  -----  -----  -----  -----  -----  ----  -----  -----  -----  -----  -----  -----  -----  -----  -----  -----  -----  -----  -----  -----  -----  -----  -----  -----  -----  -----  -----  -----  -----  -----  -----  -----  -----  -----  -----  -----  -----  -----  -----  -----  -----  -----  -----  -----  -----  -----  -----  -----  -----  -----  -----  -----  -----  -----  -----  -----  -----  -----  -----  -----  -----  -----  -----  -----  -----  -----  -----  -----  -----  -----  -----  -----  -----  -----  -----  -----  -----  -----  -----  -----  -----  -----  -----  -----  -----  -----  -----  -----  -----  -----  -----  -----  -----  -----  -----  -----  -----  -----  -----  -----  -----  -----  -----  -----  -----  -----  -----  -----  ----  ----  ----  ----  ----  ----  ----  ----  ----  ----  ----  ----  ----  ----  -----  -----  -----  -----  -----  -----  ----  ----  ----  -----  -----  ----  ----  ----  ----  ----  ----  ----  ----  -----  ----  ----  ----  ----  ----  ----  -----  -----  -----  -----  -----  -----  ----  -----  -----  -----  -----  -----  ----  ----  ----  ----  ----  ----  ----  ----  ----  ----  ----  ----  ----  -----  -----  -----  -----  -----  -----  -----  -----  -----  -----  -----  ----  ----  ----  ----  ----  ----  ----  -----  ----  ----  ----  ----  ----  -----  -----  -----  -----  -----  -----  -----  -----  -----  -----  -----  ----  ----  ----  ----  ----  ----  ----  ----  -----  -----  ----  ----  ----  ----  ----  -----  -----  -----  -----  -----  -----  -----  -----  -----  -----  ----  ----  ----  ----  ----  ----  ----  ----  ----  -----  -----  ----  ----  ----  ----  ----  -----  -----  -----  -----  -----  -----  -----  -----  -----  -----  ----  ----  ----  ----  ----  ----  -----  ----  ----  ----  ----  -----  -----  -----  ----  -----  -----  -----  -----  -----  -----  -----  -----  -----  ----  -----  ----  ----  ----  ----  -----  -----  ----  ----  -----  ----  -----  ----  -----  -----  -----  -----  -----  -----  -----  -----  -----  -----  -----
    ## site_luq_LFDP     940    912    551    418    435    522    795   1045    768   587    900   1383    579    953    978   1754   2016   2109   1951   1756   687   2168   2338   2494   2020   1589   2068   1050   928   736   623   995   749   1025   1352    918   1151    617    591    937    735    631    964    859   628   1009   1084   1213   1587   1719   1384   1685   1798   1634   1942   717   1891   1707   2338   1348   1836   1467   497   1272   1484   1615   1055   1076   930   1036   1068   1612    886    973    979   1033    585    798    435   990   1397    723   1555   1188    981    965   1185   1308   1863   1581   544   2108   1970   2014   1093   2148   2144   848   1689   1842   1163   1082   1078    842   1092    961    411    523    445   1247    955   1584   1797   1347    797   1544   2221   2424   1184   1864   2187   1203   1295   1934   1691   1155   1511   1561   1137    827    937    589    965    835    467    770   1861   1343   2810   1650   1561   2084   1660   1786    964   1496   1613   1589   2077   1533   1186   1693   1480    945    816    683    737   1184    849    707   1152   1717   1507   2682   2127   2198   1535   1497   1337    983   1018   1218   1504    911   1104   1320   1578   1761    732    458    554    838    733    845    803    817    719   1735   1894   2056   2057   1692   1535    988   1330   1062   1269   1184   1016   1018   779   496   871   991   965   802   698   623   969   817   463   819   551   707   1203   1245   1110   1331   1356   1771   660   818   664   1593   1965   843   938   711   684   582   547   473   585   1179   647   555   586   442   511   687   1413   1630   1309   1281   1060   1398   852   1228   1469   1583   1184   1458   945   746   321   539   610   720   788   727   584   743   486   570   799   1357   1993   1526   1005   1093   2082   1726   1903   1568   2119   1007   776   847   659   473   754   785   768   1223   917   670   796   397   845   1082   1580   1530   1292   1621   1566   2421   2277   1542   1635   1441   592   687   585   511   752   554   699   813   1070   1514   987   513   441   832   972   1575   1033   1152   1586   1808   2241   2455   2260   1328   1293   745   512   681   482   489   438   748   693   958   1355   1355   488   664   968   723   861   2044   1675   1834   1876   2231   1916   2087   2184   1145   1314   949   720   527   543   361   817   1110   993   806   934   782   1476   1749   1017   892   1530   1562   1422   2595   2532   3156   2002   2023   1668   776   1164   813   683   639   528   1066   1112   752   401   1309   985   1341   866   1227   1498   1536   1940   1384   1794   2076   2698   2270   1743   1602
