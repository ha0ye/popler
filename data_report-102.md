popler\_data\_organizatonal\_hierarchy
================
Hao Ye, Ellen Bledsoe
5/21/2019

``` r
library(tidyverse)

all_data <- readRDS("list_df.rds")
df <- as_tibble(all_data[[params$dataset_index]])

cat("My project metadata key is ", 
    df$proj_metadata_key[1], "!!")
```

    ## My project metadata key is  700 !!

``` r
# figure out the spatial replication levels
df %>% 
  select(starts_with("spatial_replication_level")) %>%
  NCOL() %>%
  {./2} -> num_sr_levels
```

``` r
# transform the names of the variables
#   - get rid of the `spatial_replication_level_#_label` columns
sr_vars <- character(num_sr_levels)
for (i in seq(num_sr_levels))
{
  new_name <- paste0(i, "--", df[1, paste0("spatial_replication_level_", i, "_label")])
  old_name <- paste0("spatial_replication_level_", i)
  sr_vars[i] <- new_name
  df <- rename(df, !!new_name := !!old_name)
}
```

``` r
# extract just the spatial replication level data
data_organization <- df %>%
  select(sr_vars)
```

``` r
# generate contingency tables to summarize organizational structure:
#   - level_i vs. level_j (i < j)

cols <- expand.grid(i = seq(num_sr_levels), 
                    j = seq(num_sr_levels)) %>%
  filter(i < j)

sr_tables <- purrr::pmap(cols, function(i, j) {
    data_organization %>%
      select(sr_vars[c(i, j)]) %>%
      table()
  })
```

``` r
# loop over tables and output
purrr::map(sr_tables, knitr::kable)
```

    ## [[1]]
    ## 
    ## 
    ##                                                   1       2       3       4
    ## -------------------------------------------  ------  ------  ------  ------
    ## site_jrn_creosotebush_086_plant_cover_quad     7950    7799    9285    9160
    ## site_jrn_grassland_086_plant_cover_quad       20962   16506   15724   18558
    ## 
    ## [[2]]
    ## 
    ## 
    ##                                                   1       2       3       4
    ## -------------------------------------------  ------  ------  ------  ------
    ## site_jrn_creosotebush_086_plant_cover_quad     5842    8093    9657   10602
    ## site_jrn_grassland_086_plant_cover_quad       17495   17698   17845   18712
    ## 
    ## [[3]]
    ## 
    ## 
    ##     1      2      3      4
    ## -----  -----  -----  -----
    ##  4872   7880   9130   7030
    ##  6962   6164   3602   7577
    ##  7115   3800   6844   7250
    ##  4388   7947   7926   7457
    ## 
    ## [[4]]
    ## 
    ## 
    ##                                                  1     10     11     12     13     14     15     16     17     18     19      2     20     21     22     23     24     25     26     27     28     29      3     30     31     32     33     34     35     36      4      5      6      7      8      9
    ## -------------------------------------------  -----  -----  -----  -----  -----  -----  -----  -----  -----  -----  -----  -----  -----  -----  -----  -----  -----  -----  -----  -----  -----  -----  -----  -----  -----  -----  -----  -----  -----  -----  -----  -----  -----  -----  -----  -----
    ## site_jrn_creosotebush_086_plant_cover_quad     876    974   1031    891    982    978    974    851    991    993   1015    856   1105    954   1045    989    805    965    939    923   1000    996    969    959    981    993    892    851    997    897    781    892    933   1087    700   1129
    ## site_jrn_grassland_086_plant_cover_quad       2070   1924   1923   2009   2041   1920   2071   1886   1872   1917   2027   2012   1909   1934   2068   2112   2088   2118   2130   1934   1985   1985   2062   1958   1954   1911   1990   1863   1906   1995   2092   2062   2034   1907   2042   2039
    ## 
    ## [[5]]
    ## 
    ## 
    ##    1    10    11    12    13    14    15    16    17    18    19     2    20    21    22    23    24    25    26    27    28    29     3    30    31    32    33    34    35    36     4     5     6     7     8     9
    ## ----  ----  ----  ----  ----  ----  ----  ----  ----  ----  ----  ----  ----  ----  ----  ----  ----  ----  ----  ----  ----  ----  ----  ----  ----  ----  ----  ----  ----  ----  ----  ----  ----  ----  ----  ----
    ##  781   780   858   783   953   804   768   793   832   836   880   785   835   861   853   815   774   869   769   814   744   879   722   792   752   765   769   720   781   749   805   757   757   859   728   890
    ##  760   562   666   714   625   590   657   618   691   630   627   705   724   641   768   773   715   750   702   667   695   651   662   714   726   646   630   687   635   686   617   640   746   690   625   670
    ##  642   694   677   628   719   772   744   700   668   674   660   672   742   715   736   752   720   631   678   601   746   642   750   613   661   689   714   594   725   715   679   731   776   666   695   788
    ##  763   862   753   775   726   732   876   626   672   770   875   706   713   671   756   761   684   833   920   775   800   809   897   798   796   804   769   713   762   742   772   826   688   779   694   820
    ## 
    ## [[6]]
    ## 
    ## 
    ##    1    10    11    12    13    14    15    16    17    18    19     2    20    21    22    23    24    25    26    27    28    29     3    30    31    32    33    34    35    36     4     5     6     7     8     9
    ## ----  ----  ----  ----  ----  ----  ----  ----  ----  ----  ----  ----  ----  ----  ----  ----  ----  ----  ----  ----  ----  ----  ----  ----  ----  ----  ----  ----  ----  ----  ----  ----  ----  ----  ----  ----
    ##  623   614   577   628   653   670   681   628   640   687   636   612   706   617   738   764   679   605   645   645   667   621   654   611   703   641   631   596   560   599   674   686   639   696   612   699
    ##  675   587   704   671   710   620   778   650   696   718   725   730   678   625   740   841   743   823   820   844   756   752   732   664   708   720   769   658   752   739   662   683   704   661   631   822
    ##  811   805   791   760   802   701   764   700   803   753   809   711   794   810   813   732   653   755   776   719   748   787   793   824   781   717   738   698   786   772   622   783   721   896   755   819
    ##  837   892   882   841   858   907   822   759   724   752   872   815   836   836   822   764   818   900   828   649   814   821   852   818   743   826   744   762   805   782   915   802   903   741   744   828
